# パスワード変更機能

## 📝 概要

店舗アカウントと運営会社アカウントの両方がパスワードを変更できる機能を実装しました。

## ✨ 実装した機能

### 1. **店舗アカウント用パスワード変更**

**画面**: `/store/manage/[id]/change-password`

**アクセス方法**:
- 店舗アカウントでログイン後、店舗更新画面の「店舗情報」カードに「パスワード変更」ボタンが表示される
- ボタンをクリックするとパスワード変更画面に遷移

**機能**:
- ✅ 現在のパスワード入力
- ✅ 新しいパスワード入力（6文字以上）
- ✅ パスワード確認入力
- ✅ リアルタイムでパスワードの一致を確認
- ✅ パスワード強度のヒント表示
- ✅ `supabase.auth.updateUser()`を使用してパスワードを更新

### 2. **運営会社アカウント用パスワード変更**

**画面**: `/profile/change-password`

**アクセス方法**:
- 運営会社アカウントでログイン後、プロフィール画面に「パスワード変更」ボタンが表示される
- ボタンをクリックするとパスワード変更画面に遷移

**機能**:
- ✅ 店舗アカウントと同じ機能
- ✅ 運営会社専用のアクセス制御

## 🎨 UI/UX

### バリデーション

1. **現在のパスワード**: 必須
2. **新しいパスワード**: 
   - 6文字以上
   - 現在のパスワードと異なる必要がある
3. **パスワード確認**: 新しいパスワードと一致する必要がある

### リアルタイムフィードバック

- パスワード確認欄で一致・不一致をリアルタイム表示
  - ✅ 一致: 緑色のチェックマーク
  - ❌ 不一致: 赤色の警告メッセージ

### パスワード強度のヒント

変更画面に以下のヒントを表示：
- 最低6文字以上
- 大文字と小文字を組み合わせる
- 数字を含める
- 記号（!@#$%など）を含める
- 推測されやすい単語は避ける

### アニメーション

Framer Motionを使用したスムーズなアニメーション：
- ページ遷移時のフェードイン
- ボタンのローディング状態

## 🔧 技術詳細

### 使用したAPI

```typescript
// Supabaseでパスワードを更新
const { error } = await supabase.auth.updateUser({
  password: newPassword,
});
```

### エラーハンドリング

- メールアドレスの重複チェック
- パスワード強度のチェック
- ネットワークエラーの処理
- わかりやすいエラーメッセージの表示

### セキュリティ

- ✅ パスワードは平文で保存されない（Supabase Authで暗号化）
- ✅ 最低6文字の制限
- ✅ 現在のパスワードと異なる必要がある
- ✅ パスワード確認による入力ミス防止
- ✅ アカウントタイプによるアクセス制御

## 📁 ファイル構成

### 新規作成したファイル

1. **店舗アカウント用パスワード変更画面**
   - `app/(main)/store/manage/[id]/change-password/page.tsx`

2. **運営会社アカウント用パスワード変更画面**
   - `app/(main)/profile/change-password/page.tsx`

### 修正したファイル

1. **店舗更新画面**
   - `app/(main)/store/manage/[id]/update/page.tsx`
   - 店舗情報カードに「パスワード変更」ボタンを追加

2. **プロフィール画面**
   - `app/(main)/profile/page.tsx`
   - 「パスワード変更」ボタンを追加

## 🚀 使用方法

### 店舗アカウントの場合

1. 店舗用メールアドレスとパスワードでログイン
2. 自動的に店舗更新画面に遷移
3. 「店舗情報」カードの「パスワード変更」ボタンをクリック
4. パスワード変更画面で入力
5. 「パスワードを変更」ボタンをクリック
6. 成功メッセージが表示され、2秒後に前の画面に戻る

### 運営会社アカウントの場合

1. 運営会社のメールアドレスとパスワードでログイン
2. プロフィール画面に移動
3. 「パスワード変更」ボタンをクリック
4. パスワード変更画面で入力
5. 「パスワードを変更」ボタンをクリック
6. 成功メッセージが表示され、2秒後にプロフィール画面に戻る

## 💡 初回ログイン時の推奨フロー

### 運営会社が店舗を作成した後

1. 運営会社は店舗に以下の情報を提供：
   ```
   ログインページ: https://あなたのドメイン/login
   メールアドレス: store@example.com
   初期パスワード: TempPassword123
   
   ※初回ログイン後、必ずパスワードを変更してください
   ```

2. 店舗は初回ログイン後、すぐにパスワード変更画面でパスワードを変更

3. 以降は新しいパスワードでログイン

## 🎯 メリット

1. **セキュリティ向上**
   - 初期パスワードを変更できる
   - 定期的なパスワード変更を推奨できる

2. **ユーザビリティ**
   - 直感的なUI
   - リアルタイムのフィードバック
   - わかりやすいエラーメッセージ

3. **保守性**
   - 標準的なSupabase APIを使用
   - コードの再利用性が高い
   - 拡張が容易

## 🔜 今後の拡張案

- パスワードリセット機能（メール送信）
- パスワード履歴の管理（同じパスワードの再利用防止）
- 2要素認証（2FA）の追加
- パスワード強度メーターの表示
- パスワード有効期限の設定

